#include <stdint.h>
#include "keyboard.h"



uint8_t left_shift = 0;
uint8_t right_shift = 0;
uint8_t caps_lock = 0;

uint32_t keyboard[180][3] = {
	{0,0,0},//000
	{0,0,8},//001 ESCAPE
	{'1','!',0},	//002
	{'2','@',0},	//003
	{'3','#',0},	//004
	{'4','$',0},	//005
	{'5','%',0},	//006
	{'6','^',0},	//007
	{'7','&',0},	//008
	{'8','*',0},	//009
	{'9','(',0},	//010
	{'0',')',0},	//011
	{'-','_',0},	//012
	{'=','+',0},	//013
	{'\b','\b',0},	//014 BACKSPACE
	{'\t','\t',0},	//015 TAB
	{'q','Q',0},	//016
	{'w','W',4304},	//017
	{'e','E',3834},	//018
	{'r','R',0},	//019
	{'t','T',3224},	//020
	{'y','Y',2873},	//021
	{'u','U',2559},	//022
	{'i','I',0},	//023
	{'o','O',0},	//024
	{'p','P',0},	//025
	{'[','{',0},	//026
	{']','}',0},	//027
	{'\n','\n',0},	//028
	{0,0,0},//029 CTRL IZQ
	{'a','A',4560},	//030
	{'s','S',4063},	//031
	{'d','D',3619},	//032
	{'f','F',3416},	//033
	{'g','G',3043},	//034
	{'h','H',2711},	//035
	{'j','J',2415},	//036
	{'k','K',2280},	//037
	{'l','L',0},	//038
	{';',':',0},	//039
	{'\'','\"',0},	//040
	{'`','~',0},	//041
	{0,0,0},//042 SHIFT IZQ
	{'\\','|',0},	//043
	{'z','Z',0},	//044
	{'x','X',0},	//045
	{'c','C',0},	//046
	{'v','V',0},	//047
	{'b','B',0},	//048
	{'n','N',0},	//049
	{'m','M',0},	//050
	{',','<',0},	//051
	{'.','>',0},	//052
	{'/','?',0},	//053 
	{0,0,0},//054 SHIFT DER
	{'*','*',0},	//055 KEY *
	{0,0,0},//056 ALT IZQ
	{' ',' ',0},	//057 SPACE
	{0,0,0},//058 CAPSLOCK
	{0,0,0},//059 F1
	{0,0,0},//060 F2
	{0,0,0},//061 F3
	{0,0,0},//062 F4
	{0,0,0},//063 F5
	{0,0,0},//064 F6
	{0,0,0},//065 F7
	{0,0,0},//066 F8
	{0,0,0},//067 F9
	{0,0,0},//068 F10
	{0,0,0},//069 NUM LOCK
	{0,0,0},//070 SCROLL LOCK
	{'7','7',0},	//071 KEY 7
	{'8','8',0},	//072 KEY 8
	{'9','9',0},	//073 KEY 9
	{'-','-',0},	//074 KEY -
	{'4','4',0},	//075 KEY 4
	{'5','5',0},	//076 KEY 5
	{'6','6',0},	//077 KEY 6
	{'+','+',0},	//078 KEY +
	{'1','1',0},	//079 KEY 1
	{'2','2',0},	//080 KEY 2
	{'3','3',0},	//081 KEY 3
	{'0','0',0},	//082 KEY 0
	{'.','.',0},	//083 KEY .
	{0,0,0},//084 SYS REQ (AT)
	{'+','*',0},	//085
	{'+','*',0},	//086
	{0,0,0},//087 F11
	{0,0,0},//088 F12
	{'+','*',0},	//089
	{0,0,0},//058 CAPSLOCK
	{0,0,0},//059 F1
	{0,0,0},//060 F2
	{0,0,0},//061 F3
	{0,0,0},//062 F4
	{0,0,0},//063 F5
	{0,0,0},//064 F6
	{0,0,0},//065 F7
	{0,0,0},//066 F8
	{0,0,0},//067 F9
	{0,0,0},//068 F10
	{0,0,0},//069 NUM LOCK
	{0,0,0},//070 SCROLL LOCK
	{0,0,0},//058 CAPSLOCK
	{0,0,0},//059 F1
	{0,0,0},//060 F2
	{0,0,0},//061 F3
	{0,0,0},//062 F4
	{0,0,0},//063 F5
	{0,0,0},//064 F6
	{0,0,0},//065 F7
	{0,0,0},//066 F8
	{0,0,0},//067 F9
	{0,0,0},//068 F10
	{0,0,0},//069 NUM LOCK
	{0,0,0},//070 SCROLL LOCK
	{0,0,0},//058 CAPSLOCK
	{0,0,0},//059 F1
	{0,0,0},//060 F2
	{0,0,0},//061 F3
	{0,0,0},//062 F4
	{0,0,0},//063 F5
	{0,0,0},//064 F6
	{0,0,0},//065 F7
	{0,0,0},//066 F8
	{0,0,0},//067 F9
	{0,0,0},//068 F10
	{0,0,0},//069 NUM LOCK
	{0,0,0},//070 SCROLL LOCK
	{0,0,0},//058 CAPSLOCK
	{0,0,0},//059 F1
	{0,0,0},//060 F2
	{0,0,0},//061 F3
	{0,0,0},//062 F4
	{0,0,0},//063 F5
	{0,0,0},//064 F6
	{0,0,0},//065 F7
	{0,0,0},//066 F8
	{0,0,0},//067 F9
	{0,0,0},//068 F10
	{0,0,0},//069 NUM LOCK
	{0,0,0},//070 SCROLL LOCK
	{0,0,0},//058 CAPSLOCK
	{0,0,0},//059 F1
	{0,0,0},//060 F2
	{0,0,0},//061 F3
	{0,0,0},//062 F4
	{0,0,0},//063 F5
	{0,0,0},//064 F6
	{0,0,0},//065 F7
	{0,0,0},//066 F8
	{0,0,0},//067 F9
	{0,0,0},//068 F10
	{0,0,0},//069 NUM LOCK
	{0,0,0},//070 SCROLL LOCK
	{0,0,0},//058 CAPSLOCK
	{0,0,0},//059 F1
	{0,0,0},//060 F2
	{0,0,0},//061 F3
	{0,0,0},//062 F4
	{0,0,0},//063 F5
	{0,0,0},//064 F6
	{0,0,0},//065 F7
	{0,0,0},//066 F8
	{0,0,0},//067 F9
	{0,0,0},//068 F10
	{0,0,0},//069 NUM LOCK
	{0,0,0},//070 SCROLL LOCK
	{0,0,0},//058 CAPSLOCK
	{0,0,0},//059 F1
	{0,0,0},//060 F2
	{0,0,0},//061 F3
	{0,0,0},//062 F4
	{0,0,0},//063 F5
	{0,0,0},//064 F6
	{0,0,0},//065 F7
	{0,0,0},//066 F8
	{0,0,0},//067 F9
	{0,0,0},//068 F10
	{0,0,0},//069 NUM LOCK
	{0,0,0},//070 SCROLL LOCK
	{0,0,0},//058 CAPSLOCK
	{0,0,0},//059 F1
	{0,0,0},//060 F2
	{0,0,0},//061 F3
	{0,0,0},//062 F4
	{0,0,0},//063 F5
	{0,0,0},//064 F6
	{0,0,0},//065 F7
	{0,0,0},//066 F8
	{0,0,0},//067 F9
	{0,0,0},//068 F10
	{0,0,0},//069 NUM LOCK
	{0,0,0},//070 SCROLL LOCK
};
uint8_t check_special_key(uint32_t c){
	if(c == 58){
		if(caps_lock){
			caps_lock = 0;
		}else{
			caps_lock = 1;
		}
		return 0;
	}else if(c == 54){
		right_shift = 1;
		return 0;
	}else if(c == 42){
		left_shift = 1;
		return 0;
	}else if(c == 54 + 0x80){
		right_shift = 0;
		return 0;
	}else if(c == 42 + 0x80){
		left_shift = 0;
		return 0;
	}else if(c > 90){
		return 0;
	}
	return 1;
}
int is_alpha(unsigned char scancode){
	return ( (keyboard[scancode][0] >= (unsigned char)'a')  && (keyboard[scancode][0] <= (unsigned char)'z') );
}

uint32_t getFrec(uint32_t scancode){
	return keyboard[scancode][2];
}

uint8_t scancode_to_char(uint32_t c) {
	int key;
	
	//Con este if determino si imprimo en Mayuscula o Minuscula
	if( caps_lock == 0 ){
		if( left_shift || right_shift ){
			key = 1;
		} else {
			key = 0;
		}
	} else {
		if( left_shift || right_shift ) {
			if( is_alpha(c) ){
				key = 0;
			} else {
				key = 1;
			}
		}else{
			if( is_alpha(c) ){
				key = 1;
			} else {
				key = 0;
			}
		}
	}
	return keyboard[c][key];
}